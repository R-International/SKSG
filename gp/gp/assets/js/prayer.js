var default_data=`        श्री गणपती अथर्वशीर्ष पारायण 
में सभी गणेश भक्तों का स्वागत है  
दैनिक संकल्प लेकर अधिक से अधिक संख्या में श्री गणपती अथर्वशीर्ष का पारायण करें एवं 
श्री चरणों में समर्पित करें

गणपती बाप्पा मोरया मंगल मूर्ति मोरया `;

var artharv= `।।श्री गणपति अथर्वशीर्ष।। 

ॐ नमस्ते गणपतये। 
त्वमेव प्रत्यक्षं तत्वमसि 
त्वमेव केवलं कर्ताऽसि 
त्वमेव केवलं धर्ताऽसि 
त्वमेव केवलं हर्ताऽसि 
त्वमेव सर्वं खल्विदं ब्रह्मासि 
त्वं साक्षादात्माऽसि नित्यम्।।1।। 
ऋतं वच्मि। सत्यं वच्मि।।2।। 
अव त्व मां। अव वक्तारं। 
अव श्रोतारं। अव दातारं। 
अव धातारं। अवानूचानमव शिष्यं। 
अव पश्चात्तात। अव पुरस्तात। 
अवोत्तरात्तात। अव दक्षिणात्तात्। 
अवचोर्ध्वात्तात्।। अवाधरात्तात्।। 
सर्वतो मां पाहि-पाहि समंतात्।।3।। 
त्वं वाङ्‍मयस्त्वं चिन्मय:। 
त्वमानंदमसयस्त्वं ब्रह्ममय:। 
त्वं सच्चिदानंदाद्वितीयोऽसि। 
त्वं प्रत्यक्षं ब्रह्मासि। 
त्वं ज्ञानमयो विज्ञानमयोऽसि।।4।। 
सर्वं जगदिदं त्वत्तो जायते। 
सर्वं जगदिदं त्वत्तस्तिष्ठति। 
सर्वं जगदिदं त्वयि लयमेष्यति। 
सर्वं जगदिदं त्वयि प्रत्येति। 
त्वं भूमिरापोऽनलोऽनिलो नभ:। 
त्वं चत्वारिवाक्पदानि।।5।। 
त्वं गुणत्रयातीत: त्वमवस्थात्रयातीत:। 
त्वं देहत्रयातीत:। त्वं कालत्रयातीत:। 
त्वं मूलाधारस्थितोऽसि नित्यं। 
त्वं शक्तित्रयात्मक:। 
त्वां योगिनो ध्यायंति नित्यं। 
त्वं ब्रह्मा त्वं विष्णुस्त्वं 
रूद्रस्त्वं इंद्रस्त्वं अग्निस्त्वं 
वायुस्त्वं सूर्यस्त्वं चंद्रमास्त्वं 
ब्रह्मभूर्भुव:स्वरोम्।।6।। 
गणादिं पूर्वमुच्चार्य वर्णादिं तदनंतरं। 
अनुस्वार: परतर:। अर्धेन्दुलसितं। 
तारेण ऋद्धं। एतत्तव मनुस्वरूपं। 
गकार: पूर्वरूपं। अकारो मध्यमरूपं। 
अनुस्वारश्चान्त्यरूपं। बिन्दुरूत्तररूपं। 
नाद: संधानं। सं हितासंधि: 
सैषा गणेश विद्या। गणकऋषि: 
निचृद्गायत्रीच्छंद:। गणपतिर्देवता। 
ॐ गं गणपतये नम:।।7।। 
एकदंताय विद्‍महे। 
वक्रतुण्डाय धीमहि। 
तन्नो दंती प्रचोदयात।।8।। 
एकदंतं चतुर्हस्तं पाशमंकुशधारिणम्। 
रदं च वरदं हस्तैर्विभ्राणं मूषकध्वजम्। 
रक्तं लंबोदरं शूर्पकर्णकं रक्तवाससम्। 
रक्तगंधाऽनुलिप्तांगं रक्तपुष्पै: सुपुजितम्।। 
भक्तानुकंपिनं देवं जगत्कारणमच्युतम्। 
आविर्भूतं च सृष्टयादौ प्रकृ‍ते: पुरुषात्परम्। 
एवं ध्यायति यो नित्यं स योगी योगिनां वर:।।9।। 
नमो व्रातपतये। नमो गणपतये। 
नम: प्रमथपतये। 
नमस्तेऽस्तु लंबोदरायैकदंताय। 
विघ्ननाशिने शिवसुताय। 
श्रीवरदमूर्तये नमो नम:।।10।।  

||स्वर : श्री  राहुल  राजाराम  घाटे  आणि  श्री अमित  अनंत कुलकर्णी||

`;

var phal=`।।श्री गणपति अथर्वशीर्ष।। 

ॐ नमस्ते गणपतये। 
त्वमेव प्रत्यक्षं तत्वमसि 
त्वमेव केवलं कर्ताऽसि 
त्वमेव केवलं धर्ताऽसि 
त्वमेव केवलं हर्ताऽसि 
त्वमेव सर्वं खल्विदं ब्रह्मासि 
त्वं साक्षादात्माऽसि नित्यम्।।1।। 
ऋतं वच्मि। सत्यं वच्मि।।2।। 
अव त्व मां। अव वक्तारं। 
अव श्रोतारं। अव दातारं। 
अव धातारं। अवानूचानमव शिष्यं। 
अव पश्चात्तात। अव पुरस्तात। 
अवोत्तरात्तात। अव दक्षिणात्तात्। 
अवचोर्ध्वात्तात्।। अवाधरात्तात्।। 
सर्वतो मां पाहि-पाहि समंतात्।।3।। 
त्वं वाङ्‍मयस्त्वं चिन्मय:। 
त्वमानंदमसयस्त्वं ब्रह्ममय:। 
त्वं सच्चिदानंदाद्वितीयोऽसि। 
त्वं प्रत्यक्षं ब्रह्मासि। 
त्वं ज्ञानमयो विज्ञानमयोऽसि।।4।। 
सर्वं जगदिदं त्वत्तो जायते। 
सर्वं जगदिदं त्वत्तस्तिष्ठति। 
सर्वं जगदिदं त्वयि लयमेष्यति। 
सर्वं जगदिदं त्वयि प्रत्येति। 
त्वं भूमिरापोऽनलोऽनिलो नभ:। 
त्वं चत्वारिवाक्पदानि।।5।। 
त्वं गुणत्रयातीत: त्वमवस्थात्रयातीत:। 
त्वं देहत्रयातीत:। त्वं कालत्रयातीत:। 
त्वं मूलाधारस्थितोऽसि नित्यं। 
त्वं शक्तित्रयात्मक:। 
त्वां योगिनो ध्यायंति नित्यं। 
त्वं ब्रह्मा त्वं विष्णुस्त्वं 
रूद्रस्त्वं इंद्रस्त्वं अग्निस्त्वं 
वायुस्त्वं सूर्यस्त्वं चंद्रमास्त्वं 
ब्रह्मभूर्भुव:स्वरोम्।।6।। 
गणादिं पूर्वमुच्चार्य वर्णादिं तदनंतरं। 
अनुस्वार: परतर:। अर्धेन्दुलसितं। 
तारेण ऋद्धं। एतत्तव मनुस्वरूपं। 
गकार: पूर्वरूपं। अकारो मध्यमरूपं। 
अनुस्वारश्चान्त्यरूपं। बिन्दुरूत्तररूपं। 
नाद: संधानं। सं हितासंधि: 
सैषा गणेश विद्या। गणकऋषि: 
निचृद्गायत्रीच्छंद:। गणपतिर्देवता। 
ॐ गं गणपतये नम:।।7।। 
एकदंताय विद्‍महे। 
वक्रतुण्डाय धीमहि। 
तन्नो दंती प्रचोदयात।।8।। 
एकदंतं चतुर्हस्तं पाशमंकुशधारिणम्। 
रदं च वरदं हस्तैर्विभ्राणं मूषकध्वजम्। 
रक्तं लंबोदरं शूर्पकर्णकं रक्तवाससम्। 
रक्तगंधाऽनुलिप्तांगं रक्तपुष्पै: सुपुजितम्।। 
भक्तानुकंपिनं देवं जगत्कारणमच्युतम्। 
आविर्भूतं च सृष्टयादौ प्रकृ‍ते: पुरुषात्परम्। 
एवं ध्यायति यो नित्यं स योगी योगिनां वर:।।9।। 
नमो व्रातपतये। नमो गणपतये। 
नम: प्रमथपतये। 
नमस्तेऽस्तु लंबोदरायैकदंताय। 
विघ्ननाशिने शिवसुताय। 
श्रीवरदमूर्तये नमो नम:।।10।। 
एतदथर्वशीर्षं योऽधीते। 
स ब्रह्मभूयाय कल्पते। 
स सर्व विघ्नैर्नबाध्यते। 
स सर्वत: सुखमेधते। 
स पञ्चमहापापात्प्रमुच्यते।।11।। 
सायमधीयानो दिवसकृतं पापं नाशयति। 
प्रातरधीयानो रात्रिकृतं पापं नाशयति। 
सायंप्रात: प्रयुंजानोऽपापो भवति। 
सर्वत्राधीयानोऽपविघ्नो भवति। 
धर्मार्थकाममोक्षं च विंदति।।12।। 
इदमथर्वशीर्षमशिष्याय न देयम्। 
यो यदि मोहाद्‍दास्यति स पापीयान् भवति। 
सहस्रावर्तनात् यं यं काममधीते तं तमनेन साधयेत्।13।। 
अनेन गणपतिमभिषिंचति 
स वाग्मी भवति 
चतुर्थ्यामनश्रन् जपति 
स विद्यावान भवति। 
इत्यथर्वणवाक्यं। 
ब्रह्माद्यावरणं विद्यात् 
न बिभेति कदाचनेति।।14।। 
यो दूर्वांकुरैंर्यजति 
स वैश्रवणोपमो भवति। 
यो लाजैर्यजति स यशोवान भवति 
स मेधावान भवति। 
यो मोदकसहस्रेण यजति 
स वाञ्छित फलमवाप्रोति। 
य: साज्यसमिद्भिर्यजति 
स सर्वं लभते स सर्वं लभते।।15।। 
अष्टौ ब्राह्मणान् सम्यग्ग्राहयित्वा 
सूर्यवर्चस्वी भवति। 
सूर्यग्रहे महानद्यां प्रतिमासंनिधौ 
वा जप्त्वा सिद्धमंत्रों भवति। 
महाविघ्नात्प्रमुच्यते। 
महादोषात्प्रमुच्यते। 
महापापात् प्रमुच्यते। 
स सर्वविद्भवति से सर्वविद्भवति। 
य एवं वेद इत्युपनिषद्‍।।16।। 

ॐ भद्रं कर्णेभिः शृणुयाम देवाः ।
भद्रं पश्येमाक्षभिर्यजत्राः ।
स्थिरैरङ्गैस्तुष्टुवागँसस्तनूभिः ।
व्यशेम देवहितं यदायूः ।
स्वस्ति न इन्द्रो वृद्धश्रवाः ।
स्वस्ति नः पूषा विश्ववेदाः ।
स्वस्ति नस्ताक्षर्यो अरिष्टनेमिः ।
स्वस्ति नो वृहस्पतिर्दधातु ॥

ॐ सहनाववतु सहनौ भुनक्तु सहवीर्यंकरवावहै तेजस्वीनावधितमस्तु मा विद्विषावहै।।

ॐ शान्तिः शान्तिः शान्तिः ॥

||स्वर : श्री  राहुल  राजाराम  घाटे  आणि  श्री अमित  अनंत कुलकर्णी||
`;
// Get the audio element
const audio = document.getElementById('audio');
const timesPlayed = document.getElementById('timesPlayed');
var pNotes=document.getElementById('pNotes');
const playCheckbox = document.getElementById("playCheckbox");
// Initialize variables to keep track of time and play count
let totalTime = 0;
var repeat_flag=0;
var pray_URL="";
var pray_Option="";
document.getElementById('pNotes').innerHTML=default_data;
const playPauseButton = document.querySelector('.play-pause-button');
const progressBarFill = document.querySelector('.progress-bar-fill');
// Event listener to update play count
var playCount = 0;
let isPlaying = false;
let isScrolling = false;
getPray(phoneNumberCookie);
audio.addEventListener('play', () => {
  if (!isPlaying) {
    playPauseButton.innerHTML = '⏸️';
    isPlaying = true;
    isScrolling = true;
    autoScroll();
    const startTime = new Date().getTime(); // Record the start time
    getPray(phoneNumberCookie);
    audio.addEventListener('timeupdate', function updateTime() {
        const currentTime = new Date().getTime();
        const elapsedTime = (currentTime - startTime) / 1000; // Convert to seconds
        console.log("Elapsed Time:",elapsedTime);
        if (audio.currentTime >= audio.duration) {
            if(playCount>=421){
              updatePray(playCount);
              getPray(phoneNumberCookie);
              timesPlayed.textContent = playCount;
              audio.removeEventListener('timeupdate', updateTime);
            }
            else{
              playCount++;
              updatePray(playCount);
              getPray(phoneNumberCookie);
              timesPlayed.textContent = playCount;
              audio.removeEventListener('timeupdate', updateTime);
            }

        }
    });
}});

audio.addEventListener('ended', () => {
    audio.currentTime = 0; // Reset the audio to the beginning
    isPlaying = false;
    isScrolling = false;
    if(repeat_flag){
        playSong(pray_URL,pray_Option);
    }
});
// Event listener to update total time played
audio.addEventListener('timeupdate', function () {
  totalTime = audio.currentTime;
  document.getElementById('totalTime').innerText = totalTime.toFixed(0);
  const progress = (audio.currentTime / audio.duration) * 100;
  progressBarFill.style.width = `${progress}%`;

});




function playSong(songUrl,op) {
pray_Option=op;
pray_URL=songUrl;
var play_start,current_datetime,time_played,current_laps;
const audioPlayer = document.getElementById('audio');
audioPlayer.src = songUrl;
audioPlayer.play();
if(op==1)
{
document.getElementById('pNotes').innerHTML=artharv;
document.getElementById('trackName').innerHTML="<b>Now Playing:</b><span><i>Atharvshirsh Parayan</i></span>";
}
else{
document.getElementById('pNotes').innerHTML=phal;
document.getElementById('trackName').innerHTML="<b>Now Playing:</b><span><i>Phalshruti</i></span>";

}
}
playPauseButton.addEventListener('click', () => {
            if (!isPlaying) {
                isPlaying = true;
                isScrolling = true;
                autoScroll();
                audio.play();
                playPauseButton.innerHTML = '⏸️';
            } else {
                isPlaying = false;
                audio.pause();
                isScrolling = false;
                playPauseButton.innerHTML = '▶️';
            }
        });

playCheckbox.addEventListener("change", function() {
            if (playCheckbox.checked) {
              repeat_flag=1;
            } else {
              repeat_flag=0;
            }
          });

    function updatePray(counter)
    {
        var currentDate = new Date();
        var year = currentDate.getFullYear();
        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
        var day = String(currentDate.getDate()).padStart(2, '0');
        var hours = String(currentDate.getHours()).padStart(2, '0');
        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
        var seconds = String(currentDate.getSeconds()).padStart(2, '0');
        var formattedDateTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
        var formattedDate = year + "-" + month + "-" + day;
        $(document).ready(function() {
                $.ajax({
                    url: "add_count.php",
                    method: "POST",
                    data: { phone_number: phoneNumberCookie,pray_count:counter,cur_date:formattedDate,cur_datetime:formattedDateTime },
                    success: function(response) {
                        //console.log(response);
                        if(response==421)
                        {
                          openFlowerModal();
                        }
                    }
                });
            });
    }
// JavaScript function to open the modal and display data
// JavaScript function to open the modal and display data
function openFlowerModal() {
  // Get a reference to the modal element
  const modal = document.getElementById('flowerModal');

  // Display the modal by adding the "show" class
  modal.classList.add('show');
  modal.style.display = 'block';

  // Handle the backdrop
  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop fade show';
  modal_hide=document.getElementById('hide_modal');

  // Prevent scrolling on the background
  document.body.classList.add('modal-open');

  // Close the modal when clicking the backdrop
  modal_hide.addEventListener('click', function () {
      modal.classList.remove('show');
      modal.style.display = 'none';
      document.body.classList.remove('modal-open');
  });
  
}



    function getPray(phone_number)
    {
        var currentDate = new Date();
        var year = currentDate.getFullYear();
        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
        var day = String(currentDate.getDate()).padStart(2, '0');
        var hours = String(currentDate.getHours()).padStart(2, '0');
        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
        var seconds = String(currentDate.getSeconds()).padStart(2, '0');
        var formattedDateTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
        var formattedDate = year + "-" + month + "-" + day;
        $(document).ready(function() {
                $.ajax({
                    url: "get_count.php",
                    method: "POST",
                    data: { phone_number: phoneNumberCookie,cur_date:formattedDate},
                    success: function(response) {
                        console.log(response);
                        playCount=parseInt(response);
                        timesPlayed.textContent = playCount;
                    }
            });
        });
    }
    function autoScroll() {
        if (!isScrolling) {
            return;
        }
    
        const audioDuration = audio.duration;
        const textareaHeight = pNotes.clientHeight;
        const contentHeight = pNotes.scrollHeight;
    
        const speed = 1; // Adjust the scrolling speed as needed
        const targetScrollTop = (contentHeight - textareaHeight) * (audio.currentTime / audioDuration);
    
        pNotes.scrollTop = targetScrollTop;
    
        requestAnimationFrame(autoScroll);
    }


    const allCount = document.getElementById('allCount');
    function updateAnimatedText(total) {
      allCount.textContent =total.toLocaleString(); // Format number with commas
      allCount.classList.add('animated'); // Apply your animation class
      allCount.style.textAlign="center";
      allCount.style.color="red";
      allCount.style.fontWeight="bold";
    }

    function getAllCount()
    {
    // Fetch the total prayCounter using AJAX
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'getallcount.php', true);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === XMLHttpRequest.DONE) {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          const totalPrayCounter = response.total || 0;
          updateAnimatedText(totalPrayCounter);
        } else {
          console.error('Error fetching data:', xhr.statusText);
        }
      }
    };
    xhr.send();
}
// Initial call to fetch and update data
getAllCount();

// Periodically fetch and update data every 10 seconds
setInterval(getAllCount, 10000); // 10000 milliseconds = 10 seconds