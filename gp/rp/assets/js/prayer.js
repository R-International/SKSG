var default_data=` श्री राम रक्षा स्तोत्र 

पारायण में सभी साधकों का स्वागत  है 
अपने सामर्थ्य के अनुसार दैनिक पारायण की संख्या का संकल्प लेकर 
पारायण श्री राम जी के  चरणों  में समर्पित  करें `;

var artharv= `ll रामरक्षा ll
ॐ श्रीगणेशाय नमः ।
अस्य श्रीरामरक्षास्तोत्रमन्त्रस्य ।
बुधकौशिकऋषिः ।
श्रीसीतारामचन्द्रो देवता ।
अनुष्टुप् छ्न्दः । सीता शक्तिः ।
श्रीमद्‍हनुमान् कीलकम् । श्रीरामचन्द्रप्रीत्यर्थे जपे विनियोगः ।
अथ ध्यानम् ।
ध्यायेदाजानुबाहुं धृतशरधनुषं बद्धपद्मासनस्थम्‌ ।
पीतं वासो वसानं नवकमलदलस्पर्धिनेत्रं प्रसन्नम् ।
वामाङ्कारूढसीता-मुखकमल-मिलल्लोचनं नीरदाभम्‌ ।
नानालङ्कारदीप्तं दधतमुरुजटामण्डनं रामचन्द्रम् ॥
इति ध्यानम् ।

चरितं रघुनाथस्य शतकोटिप्रविस्तरम् । एकैकमक्षरं पुंसां महापातकनाशनम् ॥१॥
ध्यात्वा नीलोत्पलश्यामं रामं राजीवलोचनम् । जानकीलक्ष्मणोपेतं जटामुकुटमण्डितम् ॥२॥
सासीतूणधनुर्बाणं पाणिं नक्तं चरान्तकम् । स्वलीलया जगत्‌त्रातुभाविर्भूतमजं विभुम् ॥३॥
रामरक्षां पठेत् प्राज्ञः पापघ्नीं सर्वकामदाम् । 
शिरो मे राघवः पातु भालं दशरथात्मजः ॥४॥
कौसल्येयो दृशौ पातु विश्वामित्रप्रियः श्रुती । घ्राणं पातु मखत्राता मुखं सौमित्रिवत्सलः ॥५॥
जिव्हां विद्यानिधिः पातु कण्ठं भरतवन्दितः । 
स्कन्धौ दिव्यायुधः पातु भुजौ भग्नेशकार्मुकः ॥६॥
करौ सीतापतिः पातु हृदयं जामदग्न्यजित् ।
 मध्यं पातु खरध्वंसी नाभिं जाम्बवदाश्रयः ॥७॥
सुग्रीवेशः कटि: पातु सक्थिनी हनुमत्प्रभुः । 
ऊरू रघूत्तमः पातु रक्षःकुलविनाशकृत् ॥८॥
जानुनी सेतुकृत् पातु जंघे दशमुखान्तकः । 
पादौ बिभीषणश्रीदः पातु रामोऽखिलं वपुः ॥९॥
एतां रामबलोपेतां रक्षां यः सुकृती पठेत् । 
स चिरायुः सुखी पुत्री विजयी विनयी भवेत् ॥१०॥ 
पातालभूतलव्योमचारिणश्छद्मचारिणः । 
न द्रष्टुमपि शक्तास्ते रक्षितं रामनामभिः ॥११॥ 
रामेति रामभद्रेति रामचन्द्रेति वा स्मरन् । 
नरो न लिप्यते पापैर् भुक्तिं मुक्तिं च विन्दति ॥१२॥
जगज्जेत्रैकमन्त्रेण रामनामाभिरक्षितम् । 
यः कण्ठे धारयेत् तस्य करस्थाः सर्वसिद्धयः ॥१३॥ 
वज्रपञ्जरनामेदं यो रामकवचं स्मरेत् । 
अव्याहताज्ञः सर्वत्र लभते जयमण्ङ्लम् ॥१४॥ 
आदिष्टवान् यथा स्वप्ने रामरक्षांमिमां हरः । 
तथा लिखितवान् प्रातः प्रबुद्धो बुधकौशिकः ॥१५॥ 
आरामः कल्पवृक्षाणां विरामः सकलापदाम् । 
अभिरामस्त्रिलोकानां रामः श्रीमान् स नः प्रभुः ॥१६॥
 तरुणौ रूपसंपन्नौ सुकुमारौ महाबलौ । 
पुण्डरीकविशालाक्षौ चीरकृष्णाजिनाम्बरौ ॥१७॥ 
फलमूलाशिनौ दान्तौ तापसौ ब्रम्हचारिणौ । 
पुत्रौ दशरथस्यैतौ भ्रातरौ रामलक्ष्मणौ ॥१८॥ 
शरण्यौ सर्वसत्त्वानां श्रेष्ठौ सर्वधनुष्मताम् । 
रक्षः कुलनिहन्तारौ त्रायेतां नो रघूत्तमौ ॥१९॥ 
आत्तसज्यधनुषाविषुस्पृशा वक्षयाशुगनिषङ्गसङ्गिनौ । 
रक्षणाय मम रामलक्ष्मणावग्रतः पथि सदैव गच्छताम् ॥२०॥
संनद्धः कवची खड्गी चापबाणोधरो युवा । 
गच्छ्न् मनोरथोऽस्माकं रामः पातु सलक्ष्मणः ॥२१॥ 
रामो दाशरथी शूरो लक्ष्मणानुचरो बली । 
काकुत्स्थः पुरुषः पूर्णः कौसल्येयो रघूत्तमः ॥२२॥ 
वेदान्तवेद्यो यज्ञेशः पुराणपुरुषोत्तमः | 
जानकीवल्लभः श्रीमानप्रमेयपराक्रमः ॥२३॥ 
इत्येतानि जपेन्नित्यं मद्भक्तः श्रद्धयान्वितः । 
अश्वमेधाधिकं पुण्यं संप्राप्नोति न संशयः ॥२४॥
रामं दूर्वादलश्यामं पद्माक्षं पीतवाससम् । 
स्तुवन्ति नामभिर्दिव्यैर् न ते संसारिणो नरः ॥२५॥
रामं लक्ष्मणपूर्वजं रघुवरं सीतापतिं सुन्दरं । 
काकुत्स्थं करुणार्णवं गुणनिधिं विप्रप्रियं धार्मिकम् । 
राजेन्द्रं सत्यसन्धं दशरथनयं श्यामलं शान्तमूर्तिं । 
वन्दे लोकाभिरामं रघुकुलतिलकं राघवं रावणारिम् ॥२६॥
रामाय रामभद्राय रामचंद्राय वेधसे । 
रघुनाथाय नाथाय सीतायाः पतये नमः ॥२७॥ 

श्रीराम राम रघुनन्दन राम राम । श्रीराम राम भरताग्रज राम राम । 
श्रीराम राम रणकर्कश राम राम । श्रीराम राम शरणं भव राम राम ॥२८॥ 

श्रीरामचन्द्रचरणौ मनसा स्मरामि । श्रीरामचन्द्रचरणौ वचसा गृणामि । 
श्रीरामचन्द्रचरणौ शिरसा नमामि । श्रीरामचन्द्रचरणौ शरणं प्रपद्ये ॥२९॥

माता रामो मत्पिता रामचन्द्रः । स्वामी रामो मत्सखा रामचन्द्रः । 
सर्वस्वं मे रामचन्द्रो दयालुर्नान्यं जाने नैव जाने न जाने ॥३०॥ 
दक्षिणे लक्ष्मणो यस्य वामे तु जनकात्मजा । 
पुरतो मारुतिर्यस्य तं वन्दे रघुनन्दनम् ॥३१॥ 
लोकाभिरामं रणरङ्गधीरं राजीवनेत्रं रघुवंशनाथम् । 
कारुण्यरूपं करुणाकरं तं श्रीरामचन्द्रं शरणं प्रपद्ये ||३२॥
मनोजवं मारुततुल्यवेगं । 
जितेद्रियं बुद्धिमतां वरिष्ठं । 
वातात्मजं वानरयूथमुख्यं । श्रीरामदूतं शरणं प्रपद्ये ॥३३॥
कूजन्तं राम रामेति मधुरं मधुराक्षरम् 
आरुह्य कविताशाखां वन्दे वाल्मीकिकोकिलम् ॥३४॥
आपदामपहर्तारं दातारं सर्वसंपदाम् । 
लोकाभिरामं श्रीरामं भूयो भूयो नमाम्यहम् ॥३५॥ 
भर्जनं भवबीजानामर्जनं सुखसंपदाम् 
तर्जनं यमदूतानां राम रामेति गर्जनम् ॥३६॥
रामो राजमणिः सदा विजयते रामं रमेशं भजे । 
रामेणाभिहता निशाचरचमू रामाय तस्मै नमः ।
रामान्नास्ति परायणं परतरं रामस्य दासोऽस्म्यहम् । 
रामे चित्तलयः सदा भवतु मे भो राम मामुद्धर ॥३७॥
रामनामेति रामेति रमे रामे मनोरमे । 
सहस्रनाम तत्तुल्यं रामनाम वरानने ॥३८॥ 
इति श्रीबुधकौशिकविरचितं श्रीरामरक्षास्तोत्रं संपूर्णम् ।

`;

var phal=`
`;
// Get the audio element
const audio = document.getElementById('audio');
const timesPlayed = document.getElementById('timesPlayed');
var pNotes=document.getElementById('pNotes');
const playCheckbox = document.getElementById("playCheckbox");
// Initialize variables to keep track of time and play count
let totalTime = 0;
var repeat_flag=0;
var pray_URL="";
var pray_Option="";
document.getElementById('pNotes').innerHTML=default_data;
const playPauseButton = document.querySelector('.play-pause-button');
const progressBarFill = document.querySelector('.progress-bar-fill');
// Event listener to update play count
var playCount = 0;
let isPlaying = false;
let isScrolling = false;
getPray(phoneNumberCookie);
audio.addEventListener('play', () => {
  if (!isPlaying) {
    playPauseButton.innerHTML = '⏸️';
    isPlaying = true;
    isScrolling = true;
    autoScroll();
    const startTime = new Date().getTime(); // Record the start time
    getPray(phoneNumberCookie);
    audio.addEventListener('timeupdate', function updateTime() {
        const currentTime = new Date().getTime();
        const elapsedTime = (currentTime - startTime) / 1000; // Convert to seconds
        console.log("Elapsed Time:",elapsedTime);
        if (audio.currentTime >= audio.duration) {
            if(playCount>=421){
              updatePray(playCount);
              getPray(phoneNumberCookie);
              timesPlayed.textContent = playCount;
              audio.removeEventListener('timeupdate', updateTime);
            }
            else{
              playCount++;
              updatePray(playCount);
              getPray(phoneNumberCookie);
              timesPlayed.textContent = playCount;
              audio.removeEventListener('timeupdate', updateTime);
            }

        }
    });
}});

audio.addEventListener('ended', () => {
    audio.currentTime = 0; // Reset the audio to the beginning
    isPlaying = false;
    isScrolling = false;
    if(repeat_flag){
        playSong(pray_URL,pray_Option);
    }
});
// Event listener to update total time played
audio.addEventListener('timeupdate', function () {
  totalTime = audio.currentTime;
  document.getElementById('totalTime').innerText = totalTime.toFixed(0);
  const progress = (audio.currentTime / audio.duration) * 100;
  progressBarFill.style.width = `${progress}%`;

});




function playSong(songUrl,op) {
pray_Option=op;
pray_URL=songUrl;
var play_start,current_datetime,time_played,current_laps;
const audioPlayer = document.getElementById('audio');
audioPlayer.src = songUrl;
audioPlayer.play();
if(op==1)
{
document.getElementById('pNotes').innerHTML=artharv;
document.getElementById('trackName').innerHTML="<b>Now Playing:</b><span><i>श्री राम रक्षा स्तोत्र</i></span>";
}
else{
document.getElementById('pNotes').innerHTML=phal;
document.getElementById('trackName').innerHTML="<b>Now Playing:</b><span><i>Phalshruti</i></span>";

}
}
playPauseButton.addEventListener('click', () => {
            if (!isPlaying) {
                isPlaying = true;
                isScrolling = true;
                autoScroll();
                audio.play();
                playPauseButton.innerHTML = '⏸️';
            } else {
                isPlaying = false;
                audio.pause();
                isScrolling = false;
                playPauseButton.innerHTML = '▶️';
            }
        });

playCheckbox.addEventListener("change", function() {
            if (playCheckbox.checked) {
              repeat_flag=1;
            } else {
              repeat_flag=0;
            }
          });

    function updatePray(counter)
    {
        var currentDate = new Date();
        var year = currentDate.getFullYear();
        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
        var day = String(currentDate.getDate()).padStart(2, '0');
        var hours = String(currentDate.getHours()).padStart(2, '0');
        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
        var seconds = String(currentDate.getSeconds()).padStart(2, '0');
        var formattedDateTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
        var formattedDate = year + "-" + month + "-" + day;
        $(document).ready(function() {
                $.ajax({
                    url: "add_count.php",
                    method: "POST",
                    data: { phone_number: phoneNumberCookie,pray_count:counter,cur_date:formattedDate,cur_datetime:formattedDateTime },
                    success: function(response) {
                        //console.log(response);
                        if(response==421)
                        {
                          openFlowerModal();
                        }
                    }
                });
            });
    }
// JavaScript function to open the modal and display data
// JavaScript function to open the modal and display data
function openFlowerModal() {
  // Get a reference to the modal element
  const modal = document.getElementById('flowerModal');

  // Display the modal by adding the "show" class
  modal.classList.add('show');
  modal.style.display = 'block';

  // Handle the backdrop
  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop fade show';
  modal_hide=document.getElementById('hide_modal');

  // Prevent scrolling on the background
  document.body.classList.add('modal-open');

  // Close the modal when clicking the backdrop
  modal_hide.addEventListener('click', function () {
      modal.classList.remove('show');
      modal.style.display = 'none';
      document.body.classList.remove('modal-open');
  });
  
}



    function getPray(phone_number)
    {
        var currentDate = new Date();
        var year = currentDate.getFullYear();
        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
        var day = String(currentDate.getDate()).padStart(2, '0');
        var hours = String(currentDate.getHours()).padStart(2, '0');
        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
        var seconds = String(currentDate.getSeconds()).padStart(2, '0');
        var formattedDateTime = year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
        var formattedDate = year + "-" + month + "-" + day;
        $(document).ready(function() {
                $.ajax({
                    url: "get_count.php",
                    method: "POST",
                    data: { phone_number: phoneNumberCookie,cur_date:formattedDate},
                    success: function(response) {
                        console.log(response);
                        playCount=parseInt(response);
                        timesPlayed.textContent = playCount;
                    }
            });
        });
    }
    function autoScroll() {
        if (!isScrolling) {
            return;
        }
    
        const audioDuration = audio.duration;
        const textareaHeight = pNotes.clientHeight;
        const contentHeight = pNotes.scrollHeight;
    
        const speed = 1; // Adjust the scrolling speed as needed
        const targetScrollTop = (contentHeight - textareaHeight) * (audio.currentTime / audioDuration);
    
        pNotes.scrollTop = targetScrollTop;
    
        requestAnimationFrame(autoScroll);
    }


    const allCount = document.getElementById('allCount');
    function updateAnimatedText(total) {
      allCount.textContent =total.toLocaleString(); // Format number with commas
      allCount.classList.add('animated'); // Apply your animation class
      allCount.style.textAlign="center";
      allCount.style.color="red";
      allCount.style.fontWeight="bold";
    }

    function getAllCount()
    {
    // Fetch the total prayCounter using AJAX
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'getallcount.php', true);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === XMLHttpRequest.DONE) {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          const totalPrayCounter = response.total || 0;
          updateAnimatedText(totalPrayCounter);
        } else {
          console.error('Error fetching data:', xhr.statusText);
        }
      }
    };
    xhr.send();
}
// Initial call to fetch and update data
getAllCount();

// Periodically fetch and update data every 10 seconds
setInterval(getAllCount, 10000); // 10000 milliseconds = 10 seconds